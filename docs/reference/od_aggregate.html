<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Aggregate OD data between polygon geometries — od_aggregate • stplanr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">stplanr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ropensci/stplanr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregate OD data between polygon geometries</h1>
    </div>

    
    <p>Aggregate OD data between polygon geometries</p>
    

    <pre class="usage"><span class='fu'>od_aggregate</span>(<span class='no'>flow</span>, <span class='no'>zones</span>, <span class='no'>aggzones</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>aggcols</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>FUN</span> <span class='kw'>=</span> <span class='no'>sum</span>, <span class='kw'>prop_by_area</span> <span class='kw'>=</span> <span class='fu'>ifelse</span>(<span class='fu'>identical</span>(<span class='no'>FUN</span>, <span class='no'>mean</span>) <span class='kw'>==</span> <span class='fl'>FALSE</span>, <span class='fl'>TRUE</span>,
  <span class='fl'>FALSE</span>), <span class='kw'>digits</span> <span class='kw'>=</span> <span class='fu'>getOption</span>(<span class='st'>"digits"</span>))</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>flow</th>
      <td><p>A data frame representing the flow between two points
or zones. The first two columns of this data frame should correspond
to the first column of the data in the zones. Thus in <code><a href='cents.html'>cents</a></code>,
the first column is geo_code. This corresponds to the first two columns
of <code><a href='flow.html'>flow</a></code>.</p></td>
    </tr>
    <tr>
      <th>zones</th>
      <td><p>A SpatialPolygonsDataFrame or SpatialPointsDataFrame
representing the original centroids or boundaries of the travel flow data.
Note that in the case of a SpatialPointsDataFrame, the entirety of the flow
will be allocated to the polygon in which the point is located rather than
being distributed by area.</p></td>
    </tr>
    <tr>
      <th>aggzones</th>
      <td><p>A SpatialPolygonsDataFrame containing the new
boundaries to aggregate to.</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>A character vector containing the names of columns on which to
apply FUN. By default, all numeric columns are aggregated.</p></td>
    </tr>
    <tr>
      <th>aggcols</th>
      <td><p>A character vector containing the names of columns in
aggzones to retain in the aggregated data.frame. By default,
only the first column is retained. These columns are renamed with a prefix
of "o_" and "d_".</p></td>
    </tr>
    <tr>
      <th>FUN</th>
      <td><p>Function to use on aggregation. Default is sum.</p></td>
    </tr>
    <tr>
      <th>prop_by_area</th>
      <td><p>Boolean value indicating if the values should be
proportionally adjusted based on area. Default is TRUE unless FUN = mean.</p></td>
    </tr>
    <tr>
      <th>digits</th>
      <td><p>The number of digits to use when proportionally adjusting
values based on area. Default is the value of getOption("digits").</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>data.frame containing the aggregated od flows.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    
    <p>Origin-destination ('OD') flow data is often provided
in the form of 1 line per flow with zone codes of origin and destination
centroids. This function aggregates OD flows between polygon geometries
allocating the original flows to larger zones based on area.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>data</span>(<span class='no'>flow</span>)
<span class='fu'>data</span>(<span class='no'>zones</span>)
<span class='no'>zones</span>@<span class='kw'>data</span>$<span class='no'>region</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>zones</span>@<span class='kw'>data</span>[<span class='fu'>c</span>(<span class='fl'>2</span>, <span class='fl'>5</span>), <span class='fu'>c</span>(<span class='st'>'region'</span>)] <span class='kw'>&lt;-</span> <span class='fl'>2</span>
<span class='no'>aggzones</span> <span class='kw'>&lt;-</span> <span class='fu'>SpatialPolygonsDataFrame</span>(<span class='kw'>rgeos</span><span class='kw'>::</span><span class='fu'>gUnaryUnion</span>(
 <span class='no'>zones</span>,
 <span class='kw'>id</span> <span class='kw'>=</span> <span class='no'>zones</span>@<span class='kw'>data</span>$<span class='no'>region</span>), <span class='fu'>data.frame</span>(<span class='kw'>region</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>1</span>, <span class='fl'>2</span>))
)
<span class='no'>zones</span>@<span class='kw'>data</span>$<span class='no'>region</span> <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>
<span class='fu'>od_aggregate</span>(<span class='no'>flow</span>, <span class='no'>zones</span>, <span class='no'>aggzones</span>)</div><div class='output co'>#&gt;   o_region d_region       All Work.mainly.at.or.from.home
#&gt; 1        1        1 1580.9990                           0
#&gt; 2        1        2  300.0000                           0
#&gt; 3        2        1  580.9998                           0
#&gt; 4        2        2  354.0000                           0
#&gt;   Underground..metro..light.rail..tram    Train Bus..minibus.or.coach      Taxi
#&gt; 1                            0.9999992 7.999994             179.99990 54.999963
#&gt; 2                            0.0000000 1.000001              44.99999  7.000000
#&gt; 3                            0.0000000 1.000000              72.99997 16.999994
#&gt; 4                            0.0000000 1.999999              42.00000  2.000001
#&gt;   Motorcycle..scooter.or.moped Driving.a.car.or.van Passenger.in.a.car.or.van
#&gt; 1                    7.9999945             537.9996                  71.99996
#&gt; 2                    0.0000001             115.0000                  14.00000
#&gt; 3                    0.0000020             230.0000                  28.99999
#&gt; 4                    0.0000000             121.0000                  13.00000
#&gt;     Bicycle  On.foot Other.method.of.travel.to.work
#&gt; 1 24.999982 682.9996                     10.9999942
#&gt; 2  9.999996 108.0000                      0.0000006
#&gt; 3 28.999992 200.9999                      0.9999997
#&gt; 4  3.000001 169.0000                      1.9999995</div><div class='input'><span class='co'># another example with more zones and plots</span>
<span class='no'>zones</span>$<span class='no'>quadrant</span> <span class='kw'>=</span> <span class='fu'><a href='quadrant.html'>quadrant</a></span>(<span class='no'>zones</span>, <span class='kw'>number_out</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='no'>aggzones</span> <span class='kw'>&lt;-</span> <span class='fu'>SpatialPolygonsDataFrame</span>(
<span class='kw'>rgeos</span><span class='kw'>::</span><span class='fu'>gUnaryUnion</span>(
 <span class='no'>zones</span>,
 <span class='kw'>id</span> <span class='kw'>=</span> <span class='no'>zones</span>@<span class='kw'>data</span>$<span class='no'>quadrant</span>), <span class='fu'>data.frame</span>(<span class='kw'>region</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1</span>:<span class='fl'>4</span>))
)
<span class='no'>od</span> <span class='kw'>=</span> <span class='fu'>od_aggregate</span>(<span class='no'>flow</span>, <span class='no'>zones</span>, <span class='no'>aggzones</span>)
<span class='no'>od_sp</span> <span class='kw'>=</span> <span class='fu'><a href='od2line.html'>od2line</a></span>(<span class='no'>flow</span>, <span class='no'>zones</span>)
<span class='no'>zones</span>@<span class='kw'>data</span> <span class='kw'>=</span> <span class='fu'>cbind</span>(<span class='fl'>1</span>:<span class='fu'>nrow</span>(<span class='no'>zones</span>), <span class='no'>zones</span>@<span class='kw'>data</span>)
<span class='no'>od_sp_agg</span> <span class='kw'>=</span> <span class='fu'><a href='od2line.html'>od2line</a></span>(<span class='no'>od</span>, <span class='no'>zones</span>, <span class='no'>aggzones</span>)
<span class='co'># plot results</span>
<span class='fu'>plot</span>(<span class='no'>aggzones</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='fl'>5</span>)</div><div class='input'><span class='fu'>plot</span>(<span class='no'>zones</span>, <span class='kw'>border</span> <span class='kw'>=</span> <span class='st'>"red"</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='input'><span class='fu'>plot</span>(<span class='no'>od_sp</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>"yellow"</span>)</div><div class='input'><span class='no'>lwd</span> <span class='kw'>=</span> <span class='no'>od_sp_agg</span>$<span class='no'>All</span> / <span class='fl'>50</span>
<span class='fu'>plot</span>(<span class='no'>od_sp_agg</span>, <span class='kw'>lwd</span> <span class='kw'>=</span> <span class='no'>lwd</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><img src='od_aggregate-7.png' alt='' width='540' height='400' /></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Robin Lovelace, Richard Ellison.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
